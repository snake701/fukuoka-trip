<script type="module">
    // 引入 Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // 1. 【請在此替換成你剛剛在 Firebase 取得的 config 內容】
    const firebaseConfig = {
        apiKey: "你的API_KEY",
        authDomain: "你的PROJECT_ID.firebaseapp.com",
        databaseURL: "你的DATABASE_URL", // 這個一定要有，連到資料庫用
        projectId: "你的PROJECT_ID",
        storageBucket: "你的PROJECT_ID.appspot.com",
        messagingSenderId: "你的SENDER_ID",
        appId: "你的APP_ID"
    };

    // 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'trip_data'); // 資料儲存在雲端的 'trip_data' 路徑下

    // --- 全域變數 (預設值) ---
    window.currentDay = 1;
    window.tripData = {};
    window.members = [];
    window.expenses = [];
    window.foods = [];
    window.checks = [];
    window.hotelData = [];
    window.emergencyInfo = [];

    // 2. 【核心邏輯：監聽雲端數據】
    // 只要雲端有任何變動，這個 function 就會被觸發，並更新你的網頁畫面
    onValue(dbRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            window.tripData = data.tripData || {};
            window.members = data.members || [];
            window.expenses = data.expenses || [];
            window.foods = data.foods || [];
            window.checks = data.checks || [];
            window.hotelData = data.hotelData || [];
            window.emergencyInfo = data.emergencyInfo || [];
            
            // 重新渲染當前畫面
            refreshUI();
        }
    });

    // 3. 【儲存數據到雲端】
    window.saveAll = function() {
        set(dbRef, {
            tripData: window.tripData,
            members: window.members,
            expenses: window.expenses,
            foods: window.foods,
            checks: window.checks,
            hotelData: window.hotelData,
            emergencyInfo: window.emergencyInfo
        });
    };

    // 輔助函式：根據目前所在的頁籤更新 UI
    function refreshUI() {
        // 這邊對應你原本寫的 render 函式
        const activeTab = document.querySelector('.nav-tab.active');
        const tabText = activeTab ? activeTab.innerText : '';
        
        renderItinerary(window.currentDay);
        if (tabText.includes('公積金')) renderMoney();
        if (tabText.includes('美食')) renderFood();
        if (tabText.includes('檢查')) renderCheck();
        if (tabText.includes('工具')) { renderHotelManager(); renderEmergency(); }
    }

    // --- 以下保留你原本的所有 function (addItem, deleteItem, render... 等) ---
    // 注意：請確保將原本 script 中的 let 變數改為 window.變數名，或確保它們在 scope 內
    
    window.switchSection = function(id, el) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(id + '-sec').classList.add('active');
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        refreshUI();
    };

    // ... (把其餘的 renderItinerary, addItem, deleteItem 等邏輯貼回來，並將裡面的 saveAll() 呼叫保留即可) ...
    // 原本程式碼中的 localStorage.setItem/getItem 都可以刪掉了，因為被 onValue 和 set 取代。
</script>
